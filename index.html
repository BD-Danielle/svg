<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SVG rendering</title>
</head>
<body>
  <div class="LUNAR_CAL">
    <div class="CURVE_DATA">
      <div id="lineGraphWrapper">
        <img src="./images/lunar2023.jpg" alt="">
        <div id="lineGraphSVG">
          <!-- cx as month -->
          <!-- cy as score -->
          <!-- level1(大吉) => 1, level2(吉) => 2, level3(平) => 3, level4(不佳) => 4-->
          <!-- svg as below -->
          <svg id="lineGraph" width="100%" height="100%">
            <polyline points="20
            ,20 60
            ,64 100
            ,108 140
            ,152 180
            ,20 220
            ,64 260
            ,108 300
            ,152 340
            ,20 380
            ,64 420
            ,152 460,
            20"></polyline>
            <circle cx="20" cy="20" r="4"></circle> <!-- Jan -->
            <circle cx="60" cy="64" r="4"></circle> <!-- Feb -->
            <circle cx="100" cy="108" r="4"></circle> <!-- Mar -->
            <circle cx="140" cy="152" r="4"></circle> <!-- Apr -->
            <circle cx="180" cy="20" r="4"></circle> <!-- May -->
            <circle cx="220" cy="64" r="4"></circle> <!-- Jun -->
            <circle cx="260" cy="108" r="4"></circle> <!-- Jul -->
            <circle cx="300" cy="152" r="4"></circle> <!-- Aug -->
            <circle cx="340" cy="20" r="4"></circle> <!-- Sep -->
            <circle cx="380" cy="64" r="4"></circle> <!-- Oct -->
            <circle cx="420" cy="152" r="4"></circle> <!-- Nov -->
            <circle cx="460" cy="20" r="4"></circle> <!-- Dec -->
          </svg>
  
          <style>
              .LUNAR_CAL{
                margin: 0 auto;
              }
              .CURVE_DATAA{
                position: relative;
                background-image: url(./images/lunar2023.jpg);
                background-repeat: no-repeat;
                background-size: 100%;
                height: inherit;
              }
              #lineGraphWrapper{
                position: relative;
                display: flex;
                justify-content: center;
              }
              #lineGraphWrapper img{
                max-width: 100%;
                height: auto;
              }
              #lineGraphSVG{
                position: absolute;
                bottom: 21.5%;
                left: 10.6%;
                width: 79%;
                height: 60%;
              }
              #lineGraph{
                stroke: #5c8f11;
                stroke-width: 3px;
              }
              #lineGraph polyline{
                fill: none;
              }
              #lineGraph circle{
                fill: #89C333;
                stroke: none;
              }
          </style>
          <script type="text/javascript">
            document.addEventListener("DOMContentLoaded", function(){
              const pointSize = 4;
              // let cx = [20, 60, 100, 140, 180, 220, 260, 300, 340, 380, 420, 460]; //fixed values
              // let cy = [20, 64, 108, 152,  20,  64, 108, 152,  20,  64, 152, 20]; //scores flexible values
              let cx = []; //fixed values
              let cy = []; //scores flexible values
              let scores = [1, 2, 3, 4, 1, 2, 3, 4, 1, 2, 3, 4]; //scores flexible values
              const polyline = document.querySelector("#lineGraph polyline");
              const circles = document.querySelectorAll("#lineGraph circle");
              let points = '';
              function getAttribute(){
                let getBoundingClientRect = document.querySelector("#lineGraphSVG").getBoundingClientRect();
                let svgHeight = getBoundingClientRect.height;
                let svgWidth = getBoundingClientRect.width;
                console.log('svgHeight: ', svgHeight, 'svgWidth: ', svgWidth);
                cx = scores.map((c, i, a)=>(i+1)*svgWidth/a.length-svgWidth/a.length/2);
                cy = scores.map((c, i, a)=>scores[i]*svgHeight/4-svgHeight/4/2);
                scores.forEach((c, i, a)=>{
                  if(i==0){
                    points+=cx[i];
                    points+=','+cy[i]+' '+cx[++i];
                  }else if(i==a.length-1){
                    points+=','+cy[i];
                  }else{
                    points+=','+cy[i]+' '+cx[++i];
                  }
                })
                polyline.setAttribute("points", points);
              }
              

              function svgRendering(){
                circles.forEach((c, i, a)=>{
                  c.setAttribute('r', pointSize);
                  c.setAttribute('cx', cx[i]);
                  c.setAttribute('cy', cy[i]);
                  
                });
              }
              getAttribute();
              svgRendering();
              window.addEventListener("resize", function(){
                points = '';
                getAttribute();
                svgRendering();
              })
            })
          </script>
        </div>
      </div>
    </div>
  </div>
</body>
</html>